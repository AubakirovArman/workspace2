# üé≠ –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "–ì–æ–≤–æ—Ä—è—â–∏–π –ê–≤–∞—Ç–∞—Ä"

–í–µ–±-—Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ —Å –≥–æ–≤–æ—Ä—è—â–∏–º –∞–≤–∞—Ç–∞—Ä–æ–º —á–µ—Ä–µ–∑ TTS –∏ Wav2Lip —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≥—É–±.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ –ø–∞–º—è—Ç–∏ (–±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è TTS —á–µ—Ä–µ–∑ API (—Ä—É—Å—Å–∫–∏–π, –∫–∞–∑–∞—Ö—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥—É–± —Å –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Wav2Lip
- ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPU –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- CUDA (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è GPU)
- ffmpeg
- Wav2Lip –º–æ–¥–µ–ª—å (`Wav2Lip-SD-GAN.pt` –∏–ª–∏ `Wav2Lip-SD-NOGAN.pt`)
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ (`avatar.jpg`)

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y ffmpeg

# macOS
brew install ffmpeg
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements_web.txt
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å:

- **–ú–æ–¥–µ–ª—å Wav2Lip**: `/workspace/Wav2Lip-SD-GAN.pt`
- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞**: `/workspace/avatar.jpg`

## üé¨ –ó–∞–ø—É—Å–∫

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫

```bash
python app.py
```

–°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CPU –≤–º–µ—Å—Ç–æ GPU
export CUDA_VISIBLE_DEVICES=""

# –£–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç
export PORT=8080

python app.py
```

## üåê –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:3000`
2. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏
3. –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ (üá∑üá∫ –†—É—Å—Å–∫–∏–π / üá∞üáø –ö–∞–∑–∞—Ö—Å–∫–∏–π / üá¨üáß –ê–Ω–≥–ª–∏–π—Å–∫–∏–π)
4. –ù–∞–∂–º–∏—Ç–µ "üé§ –û–∑–≤—É—á–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ"
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–æ–±—ã—á–Ω–æ 15-30 —Å–µ–∫—É–Ω–¥)
6. –°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ –≤–∏–¥–µ–æ

### API

#### POST `/api/generate`

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ —Å –≥–æ–≤–æ—Ä—è—â–∏–º –∞–≤–∞—Ç–∞—Ä–æ–º

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "text": "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.",
  "language": "ru"
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `text` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏
- `language` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —è–∑—ã–∫: `ru`, `kk`, `en` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `ru`)

**–û—Ç–≤–µ—Ç:**
- –í–∏–¥–µ–æ —Ñ–∞–π–ª (MP4)

**–ü—Ä–∏–º–µ—Ä —Å curl:**
```bash
curl -X POST http://localhost:3000/api/generate \
  -H "Content-Type: application/json" \
  -d '{"text": "–ü—Ä–∏–≤–µ—Ç –º–∏—Ä", "language": "ru"}' \
  --output result.mp4
```

**–ü—Ä–∏–º–µ—Ä —Å Python:**
```python
import requests

response = requests.post(
    'http://localhost:3000/api/generate',
    json={
        'text': '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
        'language': 'ru'
    }
)

with open('avatar_video.mp4', 'wb') as f:
    f.write(response.content)
```

#### GET `/api/health`

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ready",
  "models_loaded": true,
  "avatar_loaded": true,
  "device": "cuda"
}
```

#### GET `/api/avatar`

–ü–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ)

| –≠—Ç–∞–ø | CPU | GPU (CUDA) |
|------|-----|------------|
| –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π (–æ–¥–∏–Ω —Ä–∞–∑) | ~10s | ~5s |
| TTS –≥–µ–Ω–µ—Ä–∞—Ü–∏—è | ~2-5s | ~2-5s |
| Lip-sync (10 —Å–µ–∫ –∞—É–¥–∏–æ) | ~30-60s | ~5-10s |
| **–ò—Ç–æ–≥–æ –Ω–∞ –∑–∞–ø—Ä–æ—Å** | ~35-70s | ~10-20s |

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ú–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ê–≤–∞—Ç–∞—Ä –¥–µ—Ä–∂–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU –¥–ª—è 3-5x —É—Å–∫–æ—Ä–µ–Ω–∏—è
- –°—Ç–∞—Ç–∏—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –≤–∏–¥–µ–æ

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/workspace/
‚îú‚îÄ‚îÄ app.py                      # –ì–ª–∞–≤–Ω—ã–π Flask —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ index.html              # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ modern-lipsync/             # –ú–æ–¥—É–ª–∏ Wav2Lip
‚îÇ   ‚îú‚îÄ‚îÄ service.py
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ face_detection/
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ avatar.jpg                  # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
‚îú‚îÄ‚îÄ Wav2Lip-SD-GAN.pt          # –ú–æ–¥–µ–ª—å Wav2Lip
‚îú‚îÄ‚îÄ outputs/                    # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
‚îú‚îÄ‚îÄ temp_web/                   # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ requirements_web.txt        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "Face not detected"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞ —á–µ—Ç–∫–æ –≤–∏–¥–Ω–æ –ª–∏—Ü–æ
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –±–æ–ª–µ–µ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–º —Ä–∞–∫—É—Ä—Å–æ–º
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Ö–æ—Ä–æ—à–∏–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º

### "CUDA out of memory"
- –£–º–µ–Ω—å—à–∏—Ç–µ batch_size –≤ `app.py`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—å—à–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
- –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ CPU (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU (–≤ 3-5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PyTorch —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å CUDA –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Wav2Lip-SD-NOGAN.pt` (–±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –Ω–∏–∂–µ –∫–∞—á–µ—Å—Ç–≤–æ)

### TTS API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- API –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —è–∑—ã–∫ –æ–∑–≤—É—á–∫–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ü—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –≤ production:

1. –î–æ–±–∞–≤—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
2. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –∏ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞—Ö:
- [Wav2Lip](https://github.com/Rudrabha/Wav2Lip) - KR Prajwal et al.
- Modern Lipsync - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞ CPU, –µ—Å–ª–∏ GPU –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

**–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è! üéâ**
